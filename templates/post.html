<!DOCTYPE html>
<html>
<head>
    <title>{{ post.title }} - BDCOM Devs Forum</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/a11y-dark.min.css">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='resources/bdf_favicon.ico') }}">
</head>
<body>

    {% include 'navbar.html' %}

    <div class="post-single">
        <h1>{{ post.title }}</h1>
        <div class="{{ post.type }} post-type">{{ post.type.upper() }}</div>
        <br><br>
        <div class="post-meta">
            <span><strong>Submitted by:</strong> {{ submitted_by }}</span> |
            <span><strong>Last modified by:</strong> {{ modified_by }}</span>
        </div>
        <hr><br>
        <div class="post-body">{{ post.content | safe }}</div><br><br>
        {% if post.reference %}
        <div class="reference-banner">
            <span class="reference-icon">🔗</span>
            <span class="reference-label">Addressing:</span>
            <a class="reference-link" href="/posts/{{ post.reference.id }}">{{ post.reference.title }}</a>
        </div>
        {% endif %}

        <div class="post-actions-single">
            <button class="editBtn" onclick="startEdit()">✏️ Edit</button>
            {% if current_ip == post.ip_address or current_ip == admin_ip %}
            <button class="deleteBtn" onclick="deletePost({{ post.id }})">🗑️ Delete</button>
            {% endif %}
        </div>

        <form id="editForm" class="filter-form" style="display:none;" onsubmit="submitEdit(event, {{ post.id }})">
            <h1>Modify</h1>
            <input type="text" id="editTitle" value="{{ post.title }}" required><br><br>
            <!-- Hidden preloaded HTML for JavaScript to set into Quill -->
            <div id="editContentRaw" style="display: none;">{{ post.content|safe }}</div>
            <!-- Quill editor container : for fixed height, try style-->
            <!-- <div id="edit-quill-container" style="height: 200px;"></div> -->
            <div id="edit-quill-container"></div>
            <input type="hidden" id="editContent">
            <br><br>
            <label><input type="radio" name="editType" value="query" {% if post.type == 'Query' %}checked{% endif %}> Query</label>
            <label><input type="radio" name="editType" value="patch" {% if post.type == 'Patch' %}checked{% endif %}> Patch</label><br><br>
            <label for="editCategory">Category:</label>
            <select id="editCategory" required>
                <option value="vxworks" {% if post.category == 'vxworks' %}selected{% endif %}>🛠️ VxWorks</option>
                <option value="linux" {% if post.category == 'linux' %}selected{% endif %}>🐧 Linux</option>
                <option value="technical" {% if post.category == 'technical' %}selected{% endif %}>💡 Technical</option>
                <option value="non technical" {% if post.category == 'non technical' %}selected{% endif %}>📖 Non Technical</option>
            </select><br><br>
            <button type="submit" class="saveEditBtn">💾 Save</button>
            <button type="button" class="cancelEditBtn" onclick="cancelEdit()">✖️ Cancel</button>
        </form>

        <br>

        <div class="comments-section">
            <h3>Feedback</h3>
            <div id="comments-container"></div>

            <form id="commentForm">
                <textarea id="commentContent" placeholder="Write a feedback..." required></textarea><br>
                <button type="submit">Give Feedback</button>
            </form>
        </div>

        <br>

        <a href="{{ url_for('index') }}">← Back to Forum</a>
    </div>

    {% include 'footer.html' %}

    <script src="{{ url_for('static', filename='js/posts.js') }}"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('pre.ql-syntax').forEach((block) => {
        hljs.highlightElement(block);
        });
    });
    </script>

</body>
</html>
