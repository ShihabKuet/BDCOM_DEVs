<!DOCTYPE html>
<html>
<head>
    <title>{{ post.title }} - BDCOM Devs Forum</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="post-single">
        <h1>{{ post.title }}</h1>
        <div class="{{ post.type }} post-type">{{ post.type.upper() }}</div>
        <p>{{ post.content }}</p>

        <div class="post-actions-single">
            <button class="editBtn" onclick="startEdit()">‚úèÔ∏è Edit</button>
            <button class="deleteBtn" onclick="deletePost({{ post.id }})">üóëÔ∏è Delete</button>
        </div>

        <form id="editForm" style="display:none;" onsubmit="submitEdit(event, {{ post.id }})">
            <input type="text" id="editTitle" value="{{ post.title }}" required><br><br>
            <textarea id="editContent" required>{{ post.content }}</textarea><br><br>
            <label><input type="radio" name="editType" value="problem" {% if post.type == 'problem' %}checked{% endif %}> Problem</label>
            <label><input type="radio" name="editType" value="solution" {% if post.type == 'solution' %}checked{% endif %}> Solution</label><br><br>
            <button type="submit" class="saveEditBtn">üíæ Save</button>
            <button type="button" class="cancelEditBtn" onclick="cancelEdit()">‚úñÔ∏è Cancel</button>
        </form>

        <br>
        <a href="{{ url_for('index') }}">‚Üê Back to Forum</a>
    </div>

    <script>
        function startEdit() {
            document.getElementById('editForm').style.display = 'block';
        }

        function cancelEdit() {
            document.getElementById('editForm').style.display = 'none';
        }

        async function submitEdit(e, postId) {
            e.preventDefault();
            const title = document.getElementById('editTitle').value;
            const content = document.getElementById('editContent').value;
            const type = document.querySelector('input[name="editType"]:checked').value;

            await fetch(`/posts/${postId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, content, type })
            });

            location.reload();
        }

        async function deletePost(postId) {
            if (confirm('Are you sure you want to delete this post?')) {
                await fetch(`/posts/${postId}`, { method: 'DELETE' });
                window.location.href = '/';
            }
        }
    </script>
</body>
</html>
